<!DOCTYPE html>
<html lang="en">

<head>
		<script defer src="https://cloud.umami.is/script.js" data-website-id="f2d4d146-1a06-4363-b4cf-f8604e8e8b1b"></script>
    <link rel="stylesheet" href="/style.css">
    <title>HTTPS for Proxmox (or, HOWTO: using a Windows CA) - christopher di-nozzi</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn how to configure HTTPS for your Proxmox server using a Windows Certificate Authority (CA). A step-by-step guide..">
</head>
<body>
<div id="header">
    <h1> <a href="/">christopher di-nozzi</a></h1>
    <nav>
        <a href="/about">about</a>
        <span>|</span>
        <a href="/projects">projects</a>
        <span>|</span>
        <a href="/blog">blog</a>
    </nav>
    <hr>
</div>
<div id="main">
  <h1>HTTPS for Promox (or, HOWTO: using a Windows CA)</h1>

  <h3>CAs are fun!</h3>

  <p>29/05/2025</p>
  <h2>Introduction</h2>
  <p>I‚Äôve recently been working on my home lab and wanted to try my hand at running a Certificate Authority (CA). I found plenty of tutorials online about setting up a Windows CA - both domain-joined and standalone - but none of them covered what to do <i>after</i> you‚Äôve set it up.</p>
  <p>This post covers what to do after finishing the setup of your CA, using the example of enabling HTTPS for a Proxmox server.</p>

  <h2>Set Up CA</h2>
  <p>There are plenty of tutorials online about setting up CAs on Windows servers, so I won‚Äôt waste bandwidth repeating them. I opted for a standalone CA rather than one that‚Äôs part of a domain‚Äîif you want to do the same, check out this article:</p>
  <p><a href="https://medium.com/thesecmaster/step-by-step-procedure-to-set-up-a-standalone-root-ca-on-windows-server-be7257461175" target="_blank">Step-by-step guide on setting up a standalone root CA</a></p>

  <h2>Installing the Root Certificate</h2>
  <p>For our client to trust any certificates generated by our CA, we‚Äôll need to install the root certificate on our systems.</p>
  <ol>
    <li>Open <i>certsrv</i>.</li>
    <li>Right-click your server, then select <strong>Properties</strong>.</li>
    <img src="../res/ca_prop.png">
    <li>Click <strong>View Certificate</strong>.</li>
    <img src="../res/view_cert.png">
    <li>Go to <strong>Details</strong> ‚Üí <strong>Copy to File...</strong>, then follow the wizard to export your certificate.</li>
    <li>Transfer the newly generated file to your client. I did this via a shared network drive.</li>
  </ol>
  <p>Then to install it:</p>
  <p><strong>On macOS:</strong> Double-click the file to install the root CA. Then, in <em>Keychain Access</em>, right-click the certificate, choose <em>Get Info</em>, open the <em>Trust</em> menu, and set it to <em>Always Trust</em>.</p>
  <img src="../res/ca_trust.png">
  <p><strong>On Windows:</strong> Follow this guide to install the certificate: 
    <a href="https://www.itechtics.com/update-root-certificates/#import-root-certificates" target="_blank">Import root certificates on Windows</a>
  </p>

  <h2>Generate CSR</h2>
  <p>Next, we generate a Certificate Signing Request (CSR) to have it signed by our CA.</p>
  <p>If you‚Äôre comfortable with command-line tools, you can use OpenSSL or the likes. If you prefer an easier method, use a site like 
    <a href="https://csrgenerator.com/" target="_blank">csrgenerator.com</a> ‚Äî this is what I did!
  </p>
  <img src="../res/csr_gen.png">
  <p><strong>Important:</strong> Be sure to include <strong>Subject Alternative Names (SANs)</strong> in your CSR. Many articles overlook this, but Firefox gave me errors when I omitted it. Including SANs fixed the issue. Maybe this was just a <a href="https://support.mozilla.org/en-US/questions/1379667" target="_blank">firefox thing.</a></p>

  <p>Save your CSR and private key as two separate files. I named them <i>proxmox.csr</i> and <i>proxmox.key</i>.</p>

  <ol>
    <li>Transfer your CSR to your CA server.</li>
    <li>In the Certification Authority console:
      <ul>
        <li>Right-click your server ‚Üí <strong>All Tasks</strong> ‚Üí <strong>Submit a new request...</strong></li>
        <img src="../res/ca_submit_new_request.png">
        <li>Select your CSR file (you may need to change the file type filter to ‚ÄúAll Files‚Äù).</li>
      </ul>
    </li>
    <li>Go to <strong>Pending Requests</strong>.
      <ul>
        <li>Right-click your certificate ‚Üí <strong>All Tasks</strong> ‚Üí <strong>Issue</strong></li>
        <img src="../res/ca_issue.png">
      </ul>
    </li>
    <li>Then go to <strong>Issued Certificates</strong> ‚Äî you should see your newly issued certificate.
      <ul>
        <li>Right-click it and select <strong>Open</strong>.</li>
        <img src="../res/cert_open.png">
        <li>Go to <strong>Details</strong> ‚Üí <strong>Copy to File...</strong>.</li>
        <li>In the wizard, make sure to select <strong>Base-64 encoded X.509 (.CER)</strong>.</li>
        <img src="../res/cert_export_base64.png">
      </ul>
    </li>
  </ol>

  <h2>Installing on Proxmox</h2>
  <ol>
    <li>Navigate to your Proxmox instance and log in. For convenience, you can do this from your CA, or transfer the certificate and key to another client.</li>
    <li>Select your server ‚Üí <strong>Certificates</strong>.</li>
    <img src="../res/proxmox_cert.png">
    <li>Click "Upload Custom Certificate".</li>
    <li>Upload your private key file and newly generated certificate.</li>
    <img src="../res/proxmox_upload_cert.png">
    <li>Click <strong>Upload</strong>.</li>
  </ol>
  <p>That‚Äôs it!</p>
  <img src="../res/proxmox_secure.png">
  <p>Note: If you previously added a certificate exception for your Proxmox server in your browser, you‚Äôll want to remove it now.</p>

  <h2>Conclusion</h2>
  <p>A pretty straightforward process once you‚Äôve done it once! Now you can enjoy a nice padlock in your URL bar. üîí</p>

  
</div>
<hr>
<footer>
    <nav>
        <a href="https://www.linkedin.com/in/christopher-d-794b35166/">linkedin</a>
        <span>|</span>
        <a href="https://unsplash.com/@chrisdinozzi">photos</a>
        <span>|</span>
        <a href="https://github.com/chrisdinozzi">github</a>
    </nav>
</footer>
</body>
</html>
